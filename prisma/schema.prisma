generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ===== AUTHENTICATION & USERS =====

enum Role {
  ADMIN
  VENDEDORA
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String   // Hashed con bcrypt
  name      String
  role      Role     @default(VENDEDORA)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  transactions Transaction[]

  @@map("users")
}

// ===== CATALOG =====

model Size {
  id          String  @id @default(uuid())
  name        String  @unique // "XS", "S", "M", "L", "XL", "TALLA_UNICA", "42", "44"
  displayName String // "Extra Small", "Mediano", "Talla Única", etc.
  sortOrder   Int     @default(0) // Para ordenar las tallas

  // Relationships
  variants ProductVariant[]

  @@map("sizes")
}

// ===== PRODUCTS =====

model Product {
  id          String   @id @default(uuid())
  name        String
  description String?
  category    String? // "Camisas", "Pantalones", "Vestidos", etc.
  basePrice   Decimal  @db.Decimal(10, 2)
  imageUrl    String? // URL de la imagen del producto
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relationships
  variants ProductVariant[]

  @@map("products")
}

model ProductVariant {
  id            String  @id @default(uuid())
  productId     String
  sizeId        String
  color         String // "Rojo", "Azul", "Negro", etc.
  sku           String? @unique // SKU opcional para identificación
  stock         Int     @default(0)
  priceOverride Decimal?  @db.Decimal(10, 2) // Precio específico de esta variante (opcional)
  isActive      Boolean @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  product          Product           @relation(fields: [productId], references: [id], onDelete: Cascade)
  size             Size              @relation(fields: [sizeId], references: [id])
  transactionItems TransactionItem[]

  @@unique([productId, sizeId, color])
  @@map("product_variants")
}

// ===== TRANSACTIONS =====

enum TransactionType {
  VENTA // Sale - decreases stock
  ENTRADA // Stock entry - increases stock
}

enum TransactionStatus {
  COMPLETADA
  CANCELADA
}

model Transaction {
  id        String            @id @default(uuid())
  type      TransactionType
  status    TransactionStatus @default(COMPLETADA)
  userId    String // Usuario que realizó la transacción
  total     Decimal           @db.Decimal(10, 2)
  notes     String? // Notas adicionales
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt

  // Relationships
  user  User              @relation(fields: [userId], references: [id])
  items TransactionItem[]

  @@map("transactions")
}

model TransactionItem {
  id        String  @id @default(uuid())
  transactionId String
  variantId     String
  quantity      Int
  unitPrice     Decimal @db.Decimal(10, 2) // Precio unitario al momento de la transacción
  subtotal      Decimal @db.Decimal(10, 2) // quantity * unitPrice

  // Relationships
  transaction Transaction    @relation(fields: [transactionId], references: [id], onDelete: Cascade)
  variant     ProductVariant @relation(fields: [variantId], references: [id])

  @@map("transaction_items")
}
